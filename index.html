<!DOCTYPE html> <html lang="ar" dir="rtl"> <head>   <meta charset="UTF-8" />   <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />   <title>WINxWIN - كسبان كسبان</title>   <script src="https://cdn.tailwindcss.com/3.4.0"></script>   <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet" />   <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>   <style>     :root {         --primary-green: #00955E;         --dark-green: #007B4D;         --gold: #ffd700;     }     body {       margin: 0;       padding: 0;       font-family: 'Tajawal', sans-serif;       color: white;       overflow: hidden;       direction: rtl;       text-align: right;     }     .form-container input {         text-align: right;         direction: rtl;     }      /* --- ✅ تعديلات السبلاش المدمج --- */     #info-form-modal {         position: fixed;         inset: 0;         background-color: white;         z-index: 250;         display: flex;         flex-direction: column;         align-items: center;         justify-content: center;         padding: 1rem;         opacity: 1;      }     .form-container {         background-color: transparent;         padding: 2rem;         border-radius: 1rem;         width: 90%;         max-width: 450px;         text-align: center;         position: relative;     }     #form-logo {         width: 60vmin;         max-width: 300px;         margin: 0 auto 1.5rem; /* ✅ تم تحديد الهامش النهائي هنا */         animation: logo-intro 2.5s forwards cubic-bezier(0.4, 0, 0.2, 1);     }     .form-fields {         opacity: 0;         animation: fields-fade-in 1.5s forwards cubic-bezier(0.4, 0, 0.2, 1);         animation-delay: 1s;      }      /* ✅ تم تعديل الأنيميشن ليبدأ من المنتصف */     @keyframes logo-intro {         0% {             transform: scale(1.2) translateY(22vh); /* التحريك للأسفل ليبدأ من المنتصف */         }         40% {             transform: scale(1.2) translateY(22vh);         }         100% {             transform: scale(1) translateY(0); /* العودة للوضع الطبيعي */             width: 30vmin;             max-width: 150px;         }     }      @keyframes fields-fade-in {         from { opacity: 0; transform: translateY(20px); }         to { opacity: 1; transform: translateY(0); }     }     /* --- نهاية تعديلات السبلاش --- */          #game-wrapper {       width: 100vw;       height: 100vh;       display: flex;       flex-direction: column;       align-items: center;       justify-content: center;       position: relative;       box-sizing: border-box;       background: url('https://i.ibb.co/1Vc2Dp8/final-board-background.png') no-repeat center center fixed;       background-size: cover;     }      .board {       width: 84.2vmin;       height: 84.2vmin;       max-width: 415px;       max-height: 415px;       display: grid;       grid-template-columns: repeat(4, 1fr);       grid-template-rows: repeat(4, 1fr);       gap: 3.0%;       padding: 5.8%;     }      .cell {       cursor: pointer;       display: flex;       align-items: center;       justify-content: center;       border: none;       background-color: transparent;     }      .cell img {       width: 80%;       height: 80%;       object-fit: contain;       animation: appear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);     }          @keyframes appear {       from { transform: scale(0.2) rotate(-90deg); opacity: 0; }       to { transform: scale(1) rotate(0deg); opacity: 1; }     }      #start-notification {       position: absolute;       top: 50%;       left: 50%;       background: linear-gradient(145deg, var(--gold), #f9a825);       padding: 0.75rem 3rem;       font-size: 1.75rem;       font-weight: 900;       color: #422d00;       text-shadow: 1px 1px 2px rgba(255,255,255,0.4);       border-radius: 5px;       box-shadow: 0 5px 15px rgba(0,0,0,0.4);       z-index: 100;       opacity: 0;       transform: translate(-50%, -50%) scale(0);     }     #start-notification.animate {         animation: ribbon-swoosh 2.5s forwards ease-in-out;     }      @keyframes ribbon-swoosh {       0% { transform: translate(-50%, -50%) scale(0) rotate(-20deg); opacity: 0; }       40% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); opacity: 1; }       80% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }       100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; }     }      .hidden { display: none !important; }      .form-container input[type="text"], .form-container .radio-group {         width: 100%;         padding: 0.75rem;         margin-bottom: 1rem;         border-radius: 0.5rem;         border: 2px solid var(--primary-green);         background-color: white;         color: var(--dark-green);         font-size: 1rem;         font-weight: bold;     }     .form-container input::placeholder {         color: #aaa;         font-weight: normal;     }     .radio-group {         border: none;          text-align: right;          color: var(--dark-green);         font-weight: bold;     }     .radio-group p { margin-bottom: 0.5rem; }     .radio-group label { margin-left: 1.5rem; }     .form-buttons {         display: flex;         gap: 1rem;         justify-content: center;         margin-top: 1.5rem;     }     .form-container button {         background-color: var(--primary-green);         color: white;         font-weight: bold;         padding: 0.75rem 2rem;         border-radius: 0.5rem;         cursor: pointer;         transition: all 0.2s;         border: none;         flex-grow: 1;     }     .form-container button:hover { background-color: var(--dark-green); transform: scale(1.05); }     #skip-btn {         background-color: #eee;         color: #888;     }      #skip-btn:hover { background-color: #ddd; }      #mute-btn {         position: absolute;         top: 20px;         right: 20px;         width: 40px;         height: 40px;         background-color: rgba(0,0,0,0.4);         border-radius: 50%;         cursor: pointer;         display: flex;         align-items: center;         justify-content: center;         border: 1px solid rgba(255,255,255,0.2);         z-index: 150;     }     #mute-btn svg { width: 24px; height: 24px; fill: white; }          #exit-btn {         position: absolute;         top: 20px;         left: 20px;         width: 40px;         height: 40px;         background-color: rgba(192, 57, 43, 0.7); /* Red color for exit */         border-radius: 50%;         cursor: pointer;         display: flex;         align-items: center;         justify-content: center;         border: 1px solid rgba(255,255,255,0.2);         z-index: 150;     }     #exit-btn svg { width: 24px; height: 24px; fill: white; }      footer {         position: absolute;         bottom: 15px;         width: 100%;         text-align: center;         font-size: 0.8rem;         color: white;         text-shadow: 1px 1px 3px #000;         padding: 0 1rem;         line-height: 1.2;         font-weight: normal;     }     footer strong {       font-weight: bold;     }      .modal-backdrop {       background-color: rgba(1, 28, 17, 0.7);       backdrop-filter: blur(8px);     }     .modal-content {       background: #e4fbf2;       color: #011f14;       border: 2px solid #ffd700;     }     .modal-button {       font-weight: bold;       padding: 0.75rem 2rem;       border-radius: 9999px;       font-size: 1.125rem;       transition: all 0.2s;       transform: scale(1);     }     .modal-button:hover {         transform: scale(1.05);     }     .modal-button-primary {         background: var(--primary-green);         color: white;     }     .modal-button-secondary {         background: #e2e8f0;         color: #4a5568;     }   </style> </head> <body>      <div id="info-form-modal">       <div class="form-container">           <img id="form-logo" src="https://i.ibb.co/C3n6cN5X/NO-BG-4x.webp" alt="Win Logo">                      <div class="form-fields">               <input type="text" id="playerName" placeholder="الاسم (اختياري)">               <input type="text" id="playerMobile" placeholder="رقم الموبايل (اختياري)">               <div class="radio-group">                 <p>هل أنت عميل في البريد المصري؟</p>                 <label><input type="radio" name="isCustomer" value="yes"> نعم</label>                 <label><input type="radio" name="isCustomer" value="no"> لا</label>               </div>               <div class="radio-group">                 <p>هل تمتلك كروت بريدية مفعّلة؟</p>                 <label><input type="radio" name="hasCards" value="yes"> نعم</label>                 <label><input type="radio" name="hasCards" value="no"> لا</label>               </div>               <div class="form-buttons">                 <button id="submit-form-btn">ابدأ اللعب</button>                 <button id="skip-btn">تخطي</button>               </div>           </div>       </div>   </div>    <div id="game-wrapper" class="hidden">     <div class="board" id="gameBoard"></div>     <div id="start-notification"></div>          <div id="exit-btn" title="إنهاء اللعبة">         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>     </div>          <div id="mute-btn" class="hidden">         <svg id="unmuted-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>         <svg id="muted-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hidden"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L7 9.02 12 4z"></path></svg>     </div>   </div>    <div id="resultModal" class="fixed inset-0 flex items-center justify-center p-4 z-50 hidden modal-backdrop">     <div class="modal-content text-center p-8 rounded-2xl shadow-2xl max-w-sm w-full relative">       <h2 id="modal-title" class="text-3xl font-bold mb-2" style="color: #007B4E;"></h2>       <p id="modal-text" class="text-gray-600 mb-6"></p>       <button id="resetButton" class="modal-button modal-button-primary">         العب مرة أخرى       </button>     </div>   </div>    <div id="confirmExitModal" class="fixed inset-0 flex items-center justify-center p-4 z-50 hidden modal-backdrop">     <div class="modal-content text-center p-8 rounded-2xl shadow-2xl max-w-sm w-full relative">         <h2 class="text-2xl font-bold mb-4" style="color: #007B4E;">تأكيد الخروج</h2>         <p class="text-gray-600 mb-6">هل أنت متأكد أنك تريد إنهاء اللعبة؟</p>         <div class="flex justify-center gap-4">             <button id="confirmExitBtn" class="modal-button modal-button-primary">نعم، اخرج</button>             <button id="cancelExitBtn" class="modal-button modal-button-secondary">لا، ابقَ</button>         </div>     </div>   </div>     <footer>     <strong>جميع الحقوق محفوظة © 2025</strong><br>     إدارة المعارض والمؤتمرات - البريد المصري   </footer>    <script>     window.addEventListener('error', function(e) {         console.error('Caught an error:', e.error);     });      const PLAYER = 'O';     const AI = 'X';     const BOARD_SIZE = 4;          const coinURL = "https://i.ibb.co/MDqdZ4Rs/Coine.png";     const xURL = "https://i.ibb.co/9xd3VGF/X.png";              let boardState = Array(BOARD_SIZE * BOARD_SIZE).fill(null);     let gameActive = false;          const winningCombinations = [       [0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15],       [0, 4, 8, 12], [1, 5, 9, 13], [2, 6, 10, 14], [3, 7, 11, 15],       [0, 5, 10, 15], [3, 6, 9, 12]     ];      const boardElement = document.getElementById('gameBoard');     const notificationElement = document.getElementById('start-notification');     const resultModal = document.getElementById('resultModal');     const modalTitle = document.getElementById('modal-title');     const modalText = document.getElementById('modal-text');     const resetButton = document.getElementById('resetButton');          const infoFormModal = document.getElementById('info-form-modal');     const submitFormBtn = document.getElementById('submit-form-btn');     const skipBtn = document.getElementById('skip-btn');     const gameWrapper = document.getElementById('game-wrapper');     const muteBtn = document.getElementById('mute-btn');     const unmutedIcon = document.getElementById('unmuted-icon');     const mutedIcon = document.getElementById('muted-icon');          const exitBtn = document.getElementById('exit-btn');     const confirmExitModal = document.getElementById('confirmExitModal');     const confirmExitBtn = document.getElementById('confirmExitBtn');     const cancelExitBtn = document.getElementById('cancelExitBtn');      let isMuted = true;     let isAudioReady = false;          let drawsCount = sessionStorage.getItem('drawsCount') ? parseInt(sessionStorage.getItem('drawsCount')) : 0;      let clickSound, winSound, startSound;     try {         clickSound = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination();         winSound = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.4, sustain: 0.5, release: 1 } }).toDestination();         startSound = new Tone.MembraneSynth().toDestination();     } catch (error) {         console.warn('Audio context initialization failed. The game will run without sound.', error);         isAudioReady = false;     }      function playSound(sound) {         if (!isMuted && isAudioReady) {             try {                 if(sound === 'click' && clickSound) clickSound.triggerAttackRelease("C5", "8n");                 if(sound === 'win' && winSound) winSound.triggerAttackRelease("G5", "4n");                 if(sound === 'start' && startSound) startSound.triggerAttackRelease("C2", "8n");             } catch (error) {                 console.warn('Failed to play sound:', error);             }         }     }          function updateMuteButton() {         muteBtn.classList.remove('hidden');         if (isMuted) {             unmutedIcon.classList.add('hidden');             mutedIcon.classList.remove('hidden');         } else {             unmutedIcon.classList.remove('hidden');             mutedIcon.classList.add('hidden');         }     }      function startGame() {       boardState.fill(null);       gameActive = false;              notificationElement.textContent = 'ابـــدأ';       notificationElement.classList.add('animate');       playSound('start');              setTimeout(() => {         notificationElement.classList.remove('animate');         gameActive = true;       }, 2500);        boardElement.innerHTML = '';       for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {         const cell = document.createElement('div');         cell.classList.add('cell');         cell.dataset.index = i;         cell.addEventListener('click', handleCellClick);         boardElement.appendChild(cell);       }       resultModal.classList.add('hidden');     }      async function handleCellClick(e) {       if (!isAudioReady && Tone.context.state !== 'running') {           try {               await Tone.start();               isAudioReady = true;               isMuted = false;               updateMuteButton();           } catch(err) {               console.warn("Could not start audio context.", err);               isAudioReady = false;           }       }        if (!gameActive) return;       const index = e.currentTarget.dataset.index;       if (boardState[index] === null) {         playSound('click');         makeMove(index, PLAYER);         if (gameActive) {           boardElement.style.pointerEvents = 'none';            aiMove();         }       }     }      function makeMove(index, player) {       if (boardState[index] !== null) return;       boardState[index] = player;       const cell = boardElement.children[index];       cell.innerHTML = '';               const img = document.createElement("img");       img.src = player === "O" ? coinURL : xURL;       img.onerror = function() {           this.style.display = 'none';           const fallbackText = player === 'O' ? 'O' : 'X';           const parent = this.parentElement;           if (parent) {               parent.textContent = fallbackText;               parent.style.fontSize = '2.5rem';               parent.style.color = 'white';               parent.style.textShadow = '1px 1px 3px #000';           }       };              cell.appendChild(img);       cell.style.cursor = 'default';              if (checkWin(player)) {         endGame(false, player);       } else if (!boardState.includes(null)) {         endGame(true);       } else if (!isWinPossible()) {         endGame(true);       }     }      function aiMove() {         if (!gameActive) {             boardElement.style.pointerEvents = 'auto';             return;         };                  const bestMove = findBestMove();                  let delay;         if (bestMove.type === 'block') {             delay = 1200 + Math.random() * 600;          } else {             delay = 500 + Math.random() * 400;          }                  setTimeout(() => {             if (bestMove.index !== -1) {                 playSound('click');                 makeMove(bestMove.index, AI);             }             boardElement.style.pointerEvents = 'auto';         }, delay);     }      function checkWin(player) {       return winningCombinations.some(c => c.every(i => boardState[i] === player));     }      function isWinPossible() {       return winningCombinations.some(combination => {         const lineValues = combination.map(index => boardState[index]);         const hasPlayer = lineValues.includes(PLAYER);         const hasAI = lineValues.includes(AI);         return !(hasPlayer && hasAI);       });     }      function endGame(isDraw, winner = null) {         gameActive = false;         resetButton.classList.add('hidden');          if (isDraw) {             drawsCount++;             sessionStorage.setItem('drawsCount', drawsCount);              if (drawsCount >= 2) {                 modalTitle.textContent = "شكرًا لمشاركتك!";                 modalText.textContent = "انتهت اللعبة بعد تعادلين. سيتم البدء من جديد.";                 setTimeout(() => resultModal.classList.remove('hidden'), 800);                 setTimeout(performExit, 3500);             } else {                 modalTitle.textContent = "تعادل!";                 modalText.textContent = "منافسة قوية. يمكنك بدء جولة جديدة.";                 resetButton.textContent = "العب مرة أخرى";                 resetButton.classList.remove("hidden");                 setTimeout(() => resultModal.classList.remove('hidden'), 800);             }         } else {              if (winner === PLAYER) {                 playSound('win');                 modalTitle.textContent = "فوز مستحق!";                 modalText.textContent = "تهانينا! سيتم إعادة تشغيل اللعبة الآن.";             } else {                  modalTitle.textContent = "حظ اوفر المرة القادمة";                 modalText.textContent = "انتهت اللعبة. سيتم البدء من جديد.";             }             setTimeout(() => resultModal.classList.remove('hidden'), 800);             setTimeout(performExit, 3500);         }     }      function findBestMove() {         let winningMove = -1;         let blockingMove = -1;         const boardSizeSq = BOARD_SIZE * BOARD_SIZE;          for (let i = 0; i < boardSizeSq; i++) {             if (boardState[i] === null) {                 boardState[i] = AI;                 if (checkWin(AI)) {                     winningMove = i;                     boardState[i] = null;                     break;                 }                 boardState[i] = null;             }         }         if (winningMove !== -1) {             return { index: winningMove, type: 'win' };         }          for (let i = 0; i < boardSizeSq; i++) {             if (boardState[i] === null) {                 boardState[i] = PLAYER;                 if (checkWin(PLAYER)) {                     blockingMove = i;                     boardState[i] = null;                     break;                 }                 boardState[i] = null;             }         }          const makeDumbMove = Math.random() < 0.5;          if (blockingMove !== -1 && !makeDumbMove) {             return { index: blockingMove, type: 'block' };         }          const available = [];         boardState.forEach((val, idx) => {             if (val === null) available.push(idx);         });          if (available.length > 0) {             return {                 index: available[Math.floor(Math.random() * available.length)],                 type: 'random'             };         } else {             return { index: -1, type: 'none' };         }     }          function performExit() {         sessionStorage.clear();         resultModal.classList.add('hidden');         confirmExitModal.classList.add('hidden');         gameWrapper.classList.add('hidden');                  drawsCount = 0;                  document.getElementById('playerName').value = '';         document.getElementById('playerMobile').value = '';         document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);          infoFormModal.classList.remove('hidden');         const logo = document.getElementById('form-logo');         const fields = document.querySelector('.form-fields');                  logo.style.animation = 'none';         fields.style.animation = 'none';                  setTimeout(() => {             logo.style.animation = '';             fields.style.animation = '';         }, 10);     }      function initializeGame() {         infoFormModal.classList.add('hidden');         gameWrapper.classList.remove('hidden');         startGame();     }          function init() {         sessionStorage.setItem('drawsCount', '0');         drawsCount = 0;     }      async function startAudioAndGame() {         if (!isAudioReady && Tone.context.state !== 'running') {             try {                 await Tone.start();                 isAudioReady = true;                 isMuted = false;                 updateMuteButton();             } catch(err) {                 console.warn("Could not start audio context on button click.", err);             }         }         initializeGame();     }      submitFormBtn.addEventListener('click', startAudioAndGame);     skipBtn.addEventListener('click', startAudioAndGame);      muteBtn.addEventListener('click', () => {         isMuted = !isMuted;         updateMuteButton();     });      resetButton.addEventListener('click', () => {         resultModal.classList.add('hidden');         startGame();     });          exitBtn.addEventListener('click', () => {         confirmExitModal.classList.remove('hidden');     });          cancelExitBtn.addEventListener('click', () => {         confirmExitModal.classList.add('hidden');     });          confirmExitBtn.addEventListener('click', performExit);      init();        </script> </body> </html> 
